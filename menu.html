<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Mode - Talahula</title>
    <!-- Orbitron Font for the Timer -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Restored Original Brand Colors */
            --ph-yellow: #FCD116; --ph-blue: #0038A8; --ph-red: #CE1126; --ph-white: #FFFFFF;
            --bg-color: #fdf6e3; --text-color: #3e2723; 
            --btn-bg: var(--ph-blue); 
        }

        [data-theme="dark"] {
            --bg-color: #1a2332; --text-color: #e6e6e6; --btn-bg: #FBC02D;
        }

        [data-theme="dark"] body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, #263238 2px, transparent 2.5px), linear-gradient(0deg, transparent 49%, #263238 50%, transparent 51%), linear-gradient(90deg, transparent 49%, #263238 50%, transparent 51%);
            background-size: 30px 30px, 60px 60px, 60px 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; transition: background-color 0.3s, color 0.3s; }

        body {
            /* Restored Original Background */
            background-color: #fcf6e6; color: var(--text-color); display: flex; flex-direction: column; align-items: center; height: 100dvh;
            background-image: linear-gradient(45deg, #e4d5b7 25%, transparent 25%, transparent 75%, #e4d5b7 75%, #e4d5b7), linear-gradient(45deg, #e4d5b7 25%, transparent 25%, transparent 75%, #e4d5b7 75%, #e4d5b7);
            background-position: 0 0, 10px 10px; background-size: 20px 20px;
        }   

        header {
            /* Restored Original Header */
            width: 100%; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid;
            border-image: linear-gradient(to right, var(--ph-blue) 33%, var(--ph-red) 33%, var(--ph-red) 66%, var(--ph-yellow) 66%) 1;
            max-width: 600px; background-color: var(--bg-color); z-index: 10;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h1 { font-weight: 900; font-size: 1.6rem; color: var(--text-color); text-shadow: 2px 2px 0px var(--ph-yellow); }
        [data-theme="dark"] h1 { text-shadow: 2px 2px 0px #000; }

        .menu-container { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; padding: 20px; gap: 25px; }

        /* Restored Original Button Styles */
        .mode-btn {
            color: white; text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; max-width: 300px; padding: 25px; border-radius: 10px;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2); transform: translateY(0); transition: transform 0.2s, box-shadow 0.2s;
            position: relative; border: 2px solid rgba(255,255,255,0.2);
        }

        .btn-daily { background-color: var(--ph-blue); }
        .btn-infinite { background-color: var(--ph-red); }

        [data-theme="dark"] .mode-btn { color: #263238; }
        [data-theme="dark"] .btn-daily { background-color: var(--ph-yellow); }
        [data-theme="dark"] .btn-infinite { background-color: #D32F2F; color: white; }

        .mode-btn:hover { transform: translateY(-4px); box-shadow: 0 9px 0 rgba(0,0,0,0.2); }
        .mode-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }

        .btn-title { font-size: 1.8rem; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
        .btn-subtitle { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; }

        /* Streak Badge */
        .streak-badge {
            background: rgba(0,0,0,0.3); padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; margin-top: 10px; font-weight: bold;
        }

        /* Toggle Switch */
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 46px; }
        .theme-switch input { display: none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
        .slider:before { background-color: white; bottom: 3px; content: ""; height: 18px; left: 3px; position: absolute; transition: .4s; width: 18px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--btn-bg); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* --- IMPROVED TIMER CSS (Kept the new clean look) --- */
        #squid-timer-container {
            width: 100%;
            max-width: 320px;
            position: relative;
            height: 110px; 
            overflow: hidden; 
            border-radius: 16px;
            
            /* Clean Card Look for Light Mode to fix "ugly" */
            background: #ffffff; 
            border: 1px solid rgba(62, 39, 35, 0.1); /* Matches your brown text color but lighter */
            box-shadow: 0 8px 20px rgba(0,0,0,0.08); /* Soft shadow to lift it off the checkerboard */
            margin-bottom: 5px;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        [data-theme="dark"] #squid-timer-container {
            /* Dark mode keeps the glass/dark look */
            background: rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
        }

        .timer-label {
            position: absolute;
            top: 12px;
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 700;
            opacity: 0.6;
            letter-spacing: 1px;
            color: var(--text-color);
            z-index: 10;
        }

        /* Wrapper to apply the scaling */
        #squid-scale-wrapper {
            position: absolute;
            top: 58%; /* Adjusted center */
            left: 50%;
            transform: translate(-50%, -50%) scale(0.13);
            display: flex;
            justify-content: center;
            align-items: center;
            width: auto;
            white-space: nowrap;
        }

        #prize {
            width: 88rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            gap: 0.5rem;
            position: relative;
            z-index: 2;
            padding: 4rem;  
        }

        #prize-text {  
            display: flex;
            gap: 1rem;
            height: 10rem;
            line-height: 10rem;
            font-size: 11rem;
            font-family: "Orbitron", sans-serif;
            color: var(--text-color);
        }

        #prize-text > .character {
            color: var(--text-color);
            opacity: 0.9;
            font-weight: 900;
        }

        #prize-text > .digit {  
            width: 8rem;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            
            /* Clean Card Style for Digits */
            background: #f0f2f5;
            color: #2d3436;
            border-bottom: 0.4rem solid #cfd8dc;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        [data-theme="dark"] #prize-text > .digit {
            background: rgba(255,255,255,0.08);
            color: #ffffff;
            border-bottom: 0.4rem solid rgba(255,255,255,0.1);
            border-top: 1px solid rgba(255,255,255,0.05);
            box-shadow: none;
        }

        #prize-text > .digit > .digit-track {  
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute; 
            left: 0%;
            top: 0%;
            translate: 0% 0%;
            transition: translate 800ms cubic-bezier(.1,.67,0,1); 
            font-weight: 900;
            white-space: pre; /* Essential for vertical stacking of numbers */
        }

        /* Footer */
        .footer-info {
            margin-top: 10px;
        }
        
        .logout-link { color: var(--text-color); font-size: 0.8rem; text-decoration: underline; }

        @media (min-width: 600px) {
            #squid-scale-wrapper { 
                transform: translate(-50%, -50%) scale(0.16); 
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <h1>TALAHULA</h1>
            <span style="font-size: 1.5rem;">ðŸ‡µðŸ‡­</span>
        </div>
        <div class="controls">
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>

    <div class="menu-container">
        
        <!-- THEMED TIMER (Cleaner Look) -->
        <div id="squid-timer-container">
            <div class="timer-label">Next Word Reset</div>
            
            <div id="squid-scale-wrapper">
                <div id="prize">
                    <div id="prize-text"></div>
                </div>
            </div>
        </div>

        <a href="filpino_wordle_daily.html" class="mode-btn btn-daily">
            <span class="btn-title">Daily</span>
            <span class="btn-subtitle">Araw-araw</span>
            <div id="daily-streak-display" class="streak-badge">Loading streak...</div>
        </a>

        <a href="filipino_wordle.html" class="mode-btn btn-infinite">
            <span class="btn-title">Infinite</span>
            <span class="btn-subtitle">Walang Hanggan</span>
        </a>
        
        <div class="footer-info">
            <span id="user-email" style="font-size: 0.8rem; margin-right: 10px;"></span>
            <a href="#" id="logout-btn" class="logout-link">Logout</a>
        </div>
    </div>

    <script>
        const toggleSwitch = document.querySelector('#theme-toggle');
        const currentTheme = localStorage.getItem('theme');

        // Apply theme immediately
        if (currentTheme) {
            document.documentElement.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') toggleSwitch.checked = true;
        }

        toggleSwitch.addEventListener('change', function(e) {
            if (e.target.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });
        
        // --- TIMER LOGIC ---
        const config = {  
            transitionDuration: 500, 
            digits: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
        }

        const getPrizeText = () => document.getElementById("prize-text");
        const getTracks = () => document.querySelectorAll(".digit > .digit-track");

        const createElement = (type, className, text) => {
            const element = document.createElement(type);
            element.className = className;
            if(text !== undefined) element.innerText = text;
            return element;
        }

        const createCharacter = character => createElement("span", "character", character);

        const createDigit = (trackIndex) => {
            const digitElement = createElement("span", "digit"),
                  trackElement = createElement("span", "digit-track");
            
            let digits = [...config.digits];
            
            trackElement.innerText = digits.join("\n"); 
            trackElement.style.lineHeight = "10rem"; 
            trackElement.style.transitionDuration = `${config.transitionDuration}ms`;
            
            digitElement.appendChild(trackElement);
            return digitElement;
        }

        function getCountdownString() {
            const now = new Date();
            const midnight = new Date(now);
            midnight.setHours(24, 0, 0, 0); 
            const diff = midnight - now;
            
            if (diff <= 0) return "00:00:00";

            // Calculate hours, minutes, seconds
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            const hStr = h.toString().padStart(2, '0');
            const mStr = m.toString().padStart(2, '0');
            const sStr = s.toString().padStart(2, '0');
            
            return `${hStr}:${mStr}:${sStr}`;
        }

        const setupClock = () => {
            const prizeText = getPrizeText();
            const template = "00:00:00";
            let digitIndex = 0;

            for(const char of template) {
                if (char === ":") {
                    prizeText.appendChild(createCharacter(":"));
                } else {
                    prizeText.appendChild(createDigit(digitIndex++));
                }
            }
        }

        const updateClock = () => {
            const timeStr = getCountdownString(); 
            const digitsOnly = timeStr.replace(/:/g, ''); 
            
            getTracks().forEach((track, index) => {
                const targetDigit = parseInt(digitsOnly[index]);
                if (!isNaN(targetDigit)) {
                    track.style.translate = `0rem ${targetDigit * -10}rem`;
                }
            });
        }

        // Init
        setupClock();
        updateClock();
        setInterval(updateClock, 1000);
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBKsGf9_qydnsTxOl1tqEa_cPTExkYCrUY",
            authDomain: "talahula-4384e.firebaseapp.com",
            projectId: "talahula-4384e",
            storageBucket: "talahula-4384e.firebasestorage.app",
            messagingSenderId: "243686926208",
            appId: "1:243686926208:web:3c52bbf254a5ea0937c365"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const GAME_APP_ID = 'talahula_web_v1'; 

        // UI Elements
        const streakDisplay = document.getElementById('daily-streak-display');
        const userEmailDisplay = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');

        // Check Auth Status & Load Streak
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userEmailDisplay.textContent = user.email || "Guest";
                
                // Fetch Streak Data
                try {
                    const statsRef = doc(db, 'artifacts', GAME_APP_ID, 'users', user.uid, 'stats', 'daily');
                    const docSnap = await getDoc(statsRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const streak = data.currentStreak || 0;
                        streakDisplay.innerText = `ðŸ”¥ Streak: ${streak}`;
                    } else {
                        streakDisplay.innerText = `ðŸ”¥ Streak: 0`;
                    }
                } catch (error) {
                    console.error("Error fetching streak:", error);
                    streakDisplay.innerText = "Error loading streak";
                }
            } else {
                window.location.href = 'login.html';
                userEmailDisplay.textContent = "Preview Mode";
                streakDisplay.innerText = "ðŸ”¥ Streak: 5";
            }
        });

        
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => {
                window.location.href = 'index.html';
            });
        });
    </script>

</body>
</html>
<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Select Mode - Talahula</title>
    <link rel="icon" type="image/png" href="talahulafinal.png">
    
    <!-- Fonts: Poppins (UI) & Orbitron (Timer) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* --- BRAND PALETTE (Preserved) --- */
            --ph-yellow: #FCD116; 
            --ph-blue: #0038A8; 
            --ph-red: #CE1126; 
            --ph-white: #FFFFFF;
            
            /* --- THEME VARIABLES --- */
            --bg-color: #fdf6e3;
            --text-color: #2d3436;
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-border: rgba(255, 255, 255, 0.5);
            --shadow-color: rgba(0, 56, 168, 0.15);
            --header-bg: rgba(253, 246, 227, 0.95);
            --glass-border: 1px solid rgba(255,255,255,0.4);
        }

        [data-theme="dark"] {
            --bg-color: #1a2332;
            --text-color: #ecf0f1;
            --card-bg: rgba(30, 41, 59, 0.8);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.4);
            --header-bg: rgba(26, 35, 50, 0.95);
            --glass-border: 1px solid rgba(255,255,255,0.1);
        }

        /* Restored Dark Mode Background Pattern */
        [data-theme="dark"] body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, #263238 2px, transparent 2.5px), linear-gradient(0deg, transparent 49%, #263238 50%, transparent 51%), linear-gradient(90deg, transparent 49%, #263238 50%, transparent 51%);
            background-size: 30px 30px, 60px 60px, 60px 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, transform 0.2s ease; -webkit-tap-highlight-color: transparent; }

        body {
            /* Restored Light Mode Background Pattern */
            background-color: #fcf6e6;
            background-image: linear-gradient(45deg, #e4d5b7 25%, transparent 25%, transparent 75%, #e4d5b7 75%, #e4d5b7), linear-gradient(45deg, #e4d5b7 25%, transparent 25%, transparent 75%, #e4d5b7 75%, #e4d5b7);
            background-position: 0 0, 10px 10px; 
            background-size: 20px 20px;
            color: var(--text-color);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100dvh;
            overflow-x: hidden;
        }

        /* --- HEADER UPGRADE --- */
        header {
            width: 100%;
            padding: 15px 24px;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 100;
            border-bottom: 4px solid transparent;
            border-image: linear-gradient(to right, var(--ph-blue) 33%, var(--ph-red) 33%, var(--ph-red) 66%, var(--ph-yellow) 66%) 1;
            box-shadow: 0 4px 20px var(--shadow-color);
            max-width: 600px;
        }

        /* Restored Talahula Header Design */
        .header-left h1 {
            font-weight: 900; 
            font-size: 1.6rem; 
            color: var(--text-color); 
            text-shadow: 2px 2px 0px var(--ph-yellow);
            display: inline-block;
            letter-spacing: normal;
        }
        
        [data-theme="dark"] .header-left h1 {
            text-shadow: 2px 2px 0px #000;
            color: var(--text-color);
        }

        /* --- MAIN CONTAINER --- */
        .menu-container {
            flex-grow: 1; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            width: 100%; max-width: 500px; padding: 30px 20px; gap: 20px;
            animation: fadeIn Up 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- BUTTON CARDS --- */
        .mode-btn {
            position: relative;
            width: 100%;
            padding: 24px;
            border-radius: 16px;
            text-decoration: none;
            display: flex; flex-direction: row; align-items: center; justify-content: space-between;
            overflow: hidden;
            box-shadow: 0 10px 25px -5px var(--shadow-color);
            border: var(--glass-border);
        }

        .btn-content { z-index: 2; display: flex; flex-direction: column; align-items: flex-start; }
        .btn-icon { z-index: 2; font-size: 2.5rem; opacity: 0.8; transition: transform 0.3s; }

        .btn-title { font-size: 1.6rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; line-height: 1; margin-bottom: 4px; }
        .btn-subtitle { font-size: 0.85rem; font-weight: 500; opacity: 0.9; }

        /* Daily Button Specifics - LIGHT MODE (Yellow) */
        .btn-daily {
            /* Changed to Yellow Gradient for Light Mode */
            background: linear-gradient(135deg, var(--ph-yellow) 0%, #ffc107 100%);
            color: #2d3436; /* Dark text for contrast on yellow */
        }
        .btn-daily::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            transform: rotate(45deg); pointer-events: none;
        }
        
        /* Infinite Button Specifics */
        .btn-infinite {
            background: linear-gradient(135deg, var(--ph-red) 0%, #8a0b19 100%);
            color: white;
        }

        /* Hover Effects */
        .mode-btn:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 15px 30px -5px rgba(0,0,0,0.3); }
        .mode-btn:hover .btn-icon { transform: rotate(10deg) scale(1.1); }
        .mode-btn:active { transform: translateY(2px) scale(0.98); }

        /* Dark Mode Button Adjustments */
        [data-theme="dark"] .btn-daily { 
            /* Revert to Blue for Dark Mode */
            background: linear-gradient(135deg, #1565C0 0%, #0D47A1 100%); 
            color: white; /* Revert text to white */
        }
        [data-theme="dark"] .btn-infinite { background: linear-gradient(135deg, #C62828 0%, #8E0000 100%); }

        /* --- STREAK BADGE UPGRADE --- */
        .streak-container {
            margin-top: 10px;
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(0, 0, 0, 0.25);
            padding: 4px 12px; border-radius: 50px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Base Fire Style */
        .streak-fire { 
            font-size: 1rem;
            transition: color 0.3s ease, filter 0.3s ease;
            color: #bdc3c7; /* Default Gray for 0 or loading */
        }

        /* Dynamic Streak Colors */
        .streak-red { color: #FF4500; filter: drop-shadow(0 0 6px rgba(255, 69, 0, 0.8)); }
        .streak-orange { color: #FF8C00; filter: drop-shadow(0 0 6px rgba(255, 140, 0, 0.8)); }
        .streak-blue { color: #00BFFF; filter: drop-shadow(0 0 8px rgba(0, 191, 255, 0.9)); }
        .streak-purple { color: #d580ff; filter: drop-shadow(0 0 8px rgba(213, 128, 255, 0.9)); }
        .streak-green { color: #2ecc71; filter: drop-shadow(0 0 10px rgba(46, 204, 113, 0.9)); }

        .streak-text { font-size: 0.85rem; font-weight: 700; color: #fff; }

        /* --- TIMER CARD UPGRADE --- */
        #squid-timer-container {
            width: 100%; height: 120px;
            background: var(--card-bg);
            border: var(--glass-border);
            border-radius: 20px;
            box-shadow: inset 0 2px 10px rgba(255,255,255,0.5), 0 8px 20px var(--shadow-color);
            position: relative; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
        }
        
        [data-theme="dark"] #squid-timer-container {
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.2), 0 8px 20px var(--shadow-color);
        }

        .timer-label {
            position: absolute; top: 12px; width: 100%; text-align: center;
            font-size: 0.75rem; text-transform: uppercase; font-weight: 800; letter-spacing: 2px;
            color: var(--text-color); opacity: 0.6; z-index: 5;
        }

        /* --- TIMER MECHANICS (Preserved) --- */
        #squid-scale-wrapper {
            position: absolute; top: 55%; left: 50%;
            transform: translate(-50%, -50%) scale(0.14);
            display: flex; justify-content: center; align-items: center;
        }
        #prize { display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 2; padding: 4rem; }
        #prize-text { display: flex; gap: 1rem; height: 10rem; line-height: 10rem; font-size: 11rem; font-family: "Orbitron", sans-serif; color: var(--text-color); }
        #prize-text > .character { color: var(--text-color); opacity: 0.8; font-weight: 900; text-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        #prize-text > .digit {
            width: 8rem; position: relative; overflow: hidden; border-radius: 12px;
            background: linear-gradient(to bottom, #f5f7fa, #c3cfe2);
            color: #2d3436; border-bottom: 0.4rem solid #b0bec5;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.2);
        }

        [data-theme="dark"] #prize-text > .digit {
            background: linear-gradient(to bottom, #37474f, #263238);
            color: #eceff1; border-bottom: 0.4rem solid #102027;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        #prize-text > .digit > .digit-track {
            width: 100%; display: flex; flex-direction: column; align-items: center;
            position: absolute; left: 0; top: 0; transition: translate 800ms cubic-bezier(.1,.67,0,1);
            font-weight: 900; white-space: pre;
        }

        /* --- TOGGLE SWITCH --- */
        .theme-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 34px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .slider { background-color: var(--ph-yellow); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* --- FOOTER --- */
        .footer-info {
            margin-top: auto; padding-bottom: 10px;
            display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0.8;
        }
        .user-pill {
            font-size: 0.75rem; background: rgba(0,0,0,0.05);
            padding: 4px 10px; border-radius: 20px; font-weight: 600;
        }
        [data-theme="dark"] .user-pill { background: rgba(255,255,255,0.1); }
        .logout-link { color: var(--ph-red); font-size: 0.8rem; text-decoration: none; font-weight: 700; transition: 0.2s; }
        .logout-link:hover { text-decoration: underline; opacity: 1; }
        
        /* Debug Button Styles */
        .debug-btn { 
            background: rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.2); 
            border-radius: 5px; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; 
            font-family: 'Poppins', sans-serif; color: var(--text-color);
        }
        [data-theme="dark"] .debug-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; }

    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <h1>TALAHULA</h1>
            <span style="font-size: 1.5rem; margin-left: 8px;">ðŸ‡µðŸ‡­</span>
        </div>
        <div class="controls">
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>

    <div class="menu-container">
        
        <!-- UPGRADED TIMER UI -->
        <div id="squid-timer-container">
            <div class="timer-label">Next Word Reset In</div>
            <div id="squid-scale-wrapper">
                <div id="prize">
                    <div id="prize-text"></div>
                </div>
            </div>
        </div>

        <!-- DAILY BUTTON -->
        <a href="filpino_wordle_daily.html" class="mode-btn btn-daily">
            <div class="btn-content">
                <span class="btn-title">Daily</span>
                <span class="btn-subtitle">Maglaro Araw-araw</span>
                
                <!-- Upgraded Streak Badge -->
                <div class="streak-container">
                    <i class="fa-solid fa-fire streak-fire"></i>
                    <span id="daily-streak-display" class="streak-text">...</span>
                </div>
            </div>
            <i class="fa-regular fa-calendar-check btn-icon"></i>
        </a>

        <!-- INFINITE BUTTON -->
        <a href="filipino_wordle.html" class="mode-btn btn-infinite">
            <div class="btn-content">
                <span class="btn-title">Infinite</span>
                <span class="btn-subtitle">Walang Hanggan</span>
            </div>
            <i class="fa-solid fa-infinity btn-icon"></i>
        </a>
        
        <!-- FOOTER -->
        <div class="footer-info">
            <span id="user-email" class="user-pill">Guest</span>
            <a href="#" id="logout-btn" class="logout-link">LOG OUT</a>
        </div>
    </div>

    <!-- TIMER LOGIC (Preserved from your upload) -->
    <script>
        const toggleSwitch = document.querySelector('#theme-toggle');
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme) {
            document.documentElement.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') toggleSwitch.checked = true;
        }

        toggleSwitch.addEventListener('change', function(e) {
            if (e.target.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });
        
        const config = { transitionDuration: 500, digits: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] }
        const getPrizeText = () => document.getElementById("prize-text");
        const getTracks = () => document.querySelectorAll(".digit > .digit-track");
        const createElement = (type, className, text) => {
            const element = document.createElement(type);
            element.className = className;
            if(text !== undefined) element.innerText = text;
            return element;
        }
        const createCharacter = character => createElement("span", "character", character);
        const createDigit = (trackIndex) => {
            const digitElement = createElement("span", "digit"), trackElement = createElement("span", "digit-track");
            let digits = [...config.digits];
            trackElement.innerText = digits.join("\n"); 
            trackElement.style.lineHeight = "10rem"; 
            trackElement.style.transitionDuration = `${config.transitionDuration}ms`;
            digitElement.appendChild(trackElement);
            return digitElement;
        }

        function getCountdownString() {
            const now = new Date();
            const midnight = new Date(now);
            midnight.setHours(24, 0, 0, 0); 
            const diff = midnight - now;
            if (diff <= 0) return "00:00:00";
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        const setupClock = () => {
            const prizeText = getPrizeText();
            const template = "00:00:00";
            let digitIndex = 0;
            for(const char of template) {
                if (char === ":") prizeText.appendChild(createCharacter(":"));
                else prizeText.appendChild(createDigit(digitIndex++));
            }
        }

        const updateClock = () => {
            const timeStr = getCountdownString(); 
            const digitsOnly = timeStr.replace(/:/g, ''); 
            getTracks().forEach((track, index) => {
                const targetDigit = parseInt(digitsOnly[index]);
                if (!isNaN(targetDigit)) track.style.translate = `0rem ${targetDigit * -10}rem`;
            });
        }
        setupClock(); updateClock(); setInterval(updateClock, 1000);
    </script>

    <!-- FIREBASE LOGIC (Updated for Dynamic Colors + Test Exposure) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBKsGf9_qydnsTxOl1tqEa_cPTExkYCrUY",
            authDomain: "talahula-4384e.firebaseapp.com",
            projectId: "talahula-4384e",
            storageBucket: "talahula-4384e.firebasestorage.app",
            messagingSenderId: "243686926208",
            appId: "1:243686926208:web:3c52bbf254a5ea0937c365"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const GAME_APP_ID = 'talahula_web_v1'; 

        const streakDisplay = document.getElementById('daily-streak-display');
        const fireIcon = document.querySelector('.streak-fire');
        const userEmailDisplay = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');

        // Helper Function to Update Streak Visuals
        function updateStreakVisual(streak) {
            streakDisplay.innerText = `${streak}`;
            
            // Reset classes
            fireIcon.className = 'fa-solid fa-fire streak-fire';
            
            // Apply color based on streak count
            if (streak >= 100) {
                fireIcon.classList.add('streak-green');
            } else if (streak >= 50) {
                fireIcon.classList.add('streak-purple');
            } else if (streak >= 10) {
                fireIcon.classList.add('streak-blue');
            } else if (streak >= 5) {
                fireIcon.classList.add('streak-red');
            } else if (streak >= 1) {
                fireIcon.classList.add('streak-orange');
            }
        }
        
        // EXPOSE TO WINDOW FOR TESTING BUTTONS
        window.updateStreakVisual = updateStreakVisual;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userEmailDisplay.textContent = user.email || "Player";
                try {
                    const statsRef = doc(db, 'artifacts', GAME_APP_ID, 'users', user.uid, 'stats', 'daily');
                    const docSnap = await getDoc(statsRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        let streak = data.currentStreak || 0;
                        const GAME_EPOCH = new Date("2024-01-01T00:00:00");
                        const msPerDay = 86400000;
                        const now = new Date();
                        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        const todayIndex = Math.floor((today - GAME_EPOCH) / msPerDay);
                        const lastWon = data.lastWonIndex || -1;
                        
                        if (streak > 0 && lastWon < todayIndex - 1) streak = 0;
                        
                        updateStreakVisual(streak);
                    } else {
                        updateStreakVisual(0);
                    }
                } catch (error) {
                    console.error("Error fetching streak:", error);
                    streakDisplay.innerText = "-";
                }
            } else {
                window.location.href = 'login.html';
                userEmailDisplay.textContent = "Preview Mode";
                updateStreakVisual(5); // Show orange fire in preview
            }
        });

        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => {
                window.location.href = 'index.html';
            });
        });
    </script>

</body>
</html>
